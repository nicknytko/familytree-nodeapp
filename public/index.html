<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Tree</title>
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
     body {
         font: 10px sans-serif;
         overflow: hidden;
     }
     .linage {
         fill: none;
         stroke: black;
     }
     .marriage {
         fill: none;
         stroke: black;
     }
     .male {
         background-color: lightblue;
         border-radius: 2px;
     }
     .female {
         background-color: pink;
         border-radius: 2px;
     }
     p {
         padding: 5px;
         margin: 0;
     }
     div.git_version {
         position: absolute;
         bottom: 0px;
         left: 50%;
         transform: translateX(-50%);
     }
    </style>
    <script src="/lodash/lodash.min.js"></script>
    <script src="/d3/d3.min.js"></script>
    <script src="/d3-dtree/dTree.min.js"></script>
    <script src="/jquery/jquery.min.js"></script>
</head>
<body>
    <div id="graph"></div>
    <div class="git_version">
        <center>
            <a target="_blank" href="https://github.com/nicknytko/familytree-nodeapp">
                <small id="version"></small>
            </a>
        </center>
    </div>
    <script>
     treeJson = d3.json("/api/all", function(error, treeData) {
      	 dTree.init(treeData, {
	     target: "#graph",
	     debug: true,
             width: window.innerWidth,
             height: window.innerHeight,
	     callbacks: {
		 nodeClick: function(name, extra) {
		     console.log(name);
		 },
                 nodeSorter: function(aName, aExtra, bName, bExtra) {
                     return Math.sign(Date.parse(aExtra.birth_date) - Date.parse(bExtra.birth_date));
                 },
		 textRenderer: function(name, extra, textClass) {
                     let markup = "<p align=\"center\" class=\"" + textClass + "\">" + name;
                     if (extra) {
                         markup += "<br>b. " + extra.birth_date;
                         if (extra.death_date) {
                             markup += "<br>d. " + extra.death_date;
                         }
                     } 
                     markup += "</p>";
                     
                     return markup;
		 }
	     }
	 });
     });
     window.onresize = function() {
         let svg = document.getElementsByTagName("svg")[0];
         svg.setAttribute("width", window.innerWidth);
         svg.setAttribute("height", window.innerHeight);
     }
     $.get("/api/version", (e) => {
         $("#version").text(e.git_small);
     });
    </script>
</body>
</html>
